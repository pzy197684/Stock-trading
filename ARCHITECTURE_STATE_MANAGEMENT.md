# Stock-tradingæ¡†æ¶çŠ¶æ€ç®¡ç†æ¶æ„è¯´æ˜

## çŠ¶æ€ç®¡ç†åˆ†å±‚è®¾è®¡

Stock-tradingæ¡†æ¶é‡‡ç”¨äº†**åˆ†å±‚çŠ¶æ€ç®¡ç†**æ¶æ„ï¼Œä¸åŒå±‚çº§è´Ÿè´£ä¸åŒçš„çŠ¶æ€ç®¡ç†èŒè´£ï¼š

### ğŸ—ï¸ æ¡†æ¶å±‚ï¼šé€šç”¨çŠ¶æ€ç®¡ç†å™¨

**æ–‡ä»¶**: `core/managers/state_manager.py`  
**ç±»å**: `StateManager`

**èŒè´£**:
- ç®¡ç†æ¡†æ¶çº§åˆ«çš„è´¦æˆ·çŠ¶æ€ (`AccountState`)
- ç®¡ç†æ ‡å‡†ä»“ä½çŠ¶æ€ (`PositionState`)
- æä¾›é€šç”¨çš„çŠ¶æ€æ“ä½œæ¥å£
- æ”¯æŒæ‰¹é‡çŠ¶æ€æ›´æ–° (`update_state_bulk`)
- æä¾›ä»“ä½é‡ç½®åŠŸèƒ½ (`reset_direction_state`)

**ä½¿ç”¨åœºæ™¯**:
- æ‰€æœ‰ç­–ç•¥çš„åŸºç¡€çŠ¶æ€ç®¡ç†
- è´¦æˆ·ä½™é¢ã€ä»“ä½ä¿¡æ¯ç­‰æ ‡å‡†çŠ¶æ€
- å¤šå¤´/ç©ºå¤´ä»“ä½çš„é€šç”¨æ“ä½œ

### ğŸ¯ ç­–ç•¥å±‚ï¼šRecoveryä¸“ç”¨çŠ¶æ€ç®¡ç†å™¨

**æ–‡ä»¶**: `core/strategy/recovery/recovery_state_persister.py`  
**ç±»å**: `RecoveryStatePersister`

**èŒè´£**:
- ç®¡ç†Recoveryç­–ç•¥çš„å¤æ‚å†…éƒ¨çŠ¶æ€
- å¤„ç†ç­–ç•¥ç‰¹æœ‰çš„çŠ¶æ€ç»“æ„ (long_state, short_state, global_state)
- æä¾›é…ç½®å˜æ›´æ£€æµ‹å’Œå…¼å®¹æ€§éªŒè¯
- æ”¯æŒçŠ¶æ€å¤‡ä»½å’Œæ¢å¤åŠŸèƒ½
- å¤„ç†ç­–ç•¥é‡å¯åçš„çŠ¶æ€æŒä¹…åŒ–æ¢å¤

**ä½¿ç”¨åœºæ™¯**:
- Recoveryç­–ç•¥çš„å¤æ‚çŠ¶æ€ç®¡ç†
- é©¬ä¸æ ¼å°”åŠ ä»“çŠ¶æ€ã€æ­¢ç›ˆçŠ¶æ€ç­‰
- ç­–ç•¥æš‚åœã€ç†”æ–­ç­‰æ§åˆ¶çŠ¶æ€
- ç»Ÿè®¡ä¿¡æ¯å’Œé”™è¯¯çŠ¶æ€

## ğŸ“Š ä¸¤è€…å¯¹æ¯”

| ç‰¹æ€§ | æ¡†æ¶StateManager | Recovery StateManager |
|------|------------------|----------------------|
| **ç®¡ç†å¯¹è±¡** | AccountState, PositionState | Recoveryç­–ç•¥å†…éƒ¨çŠ¶æ€å¯¹è±¡ |
| **çŠ¶æ€å¤æ‚åº¦** | ç®€å•æ ‡å‡†ç»“æ„ | å¤æ‚å¤šå±‚åµŒå¥—ç»“æ„ |
| **é…ç½®ç®¡ç†** | åŸºç¡€é…ç½®åŠ è½½ | é…ç½®å“ˆå¸Œå’Œå…¼å®¹æ€§æ£€æŸ¥ |
| **æŒä¹…åŒ–** | ç›´æ¥è°ƒç”¨state_storeå‡½æ•° | é€šè¿‡StateStoreå®ä¾‹ |
| **å¤‡ä»½æ¢å¤** | ä¸æ”¯æŒ | æ”¯æŒçŠ¶æ€å¤‡ä»½å’Œæ¢å¤ |
| **é€‚ç”¨èŒƒå›´** | æ‰€æœ‰ç­–ç•¥é€šç”¨ | Recoveryç­–ç•¥ä¸“ç”¨ |

## ğŸ”„ åä½œå…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Recovery Strategy          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  RecoveryStatePersister            â”‚  â† ç­–ç•¥ç‰¹å®šçŠ¶æ€
â”‚  - å¤æ‚ç­–ç•¥çŠ¶æ€æŒä¹…åŒ–ç®¡ç†               â”‚
â”‚  - çŠ¶æ€å¤‡ä»½æ¢å¤                      â”‚
â”‚  - é…ç½®å…¼å®¹æ€§æ£€æŸ¥                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ ç»§æ‰¿/ä¾èµ–
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Framework Core               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  StateManager (é€šç”¨)                â”‚  â† æ¡†æ¶åŸºç¡€çŠ¶æ€
â”‚  - AccountStateç®¡ç†                 â”‚
â”‚  - PositionStateç®¡ç†                â”‚
â”‚  - åŸºç¡€çŠ¶æ€æ“ä½œ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ è®¾è®¡ä¼˜åŠ¿

1. **èŒè´£åˆ†ç¦»**: æ¡†æ¶å’Œç­–ç•¥çŠ¶æ€ç®¡ç†èŒè´£æ¸…æ™°åˆ†ç¦»
2. **å¤ç”¨æ€§**: æ¡†æ¶å±‚å¯è¢«æ‰€æœ‰ç­–ç•¥å¤ç”¨
3. **æ‰©å±•æ€§**: æ¯ä¸ªç­–ç•¥å¯å®šåˆ¶è‡ªå·±çš„çŠ¶æ€ç®¡ç†é€»è¾‘
4. **ç»´æŠ¤æ€§**: å„å±‚ç‹¬ç«‹ç»´æŠ¤ï¼Œé™ä½è€¦åˆ
5. **ä¸“ä¸šæ€§**: å¤æ‚ç­–ç•¥æœ‰ä¸“é—¨çš„çŠ¶æ€ç®¡ç†æ”¯æŒ

## ğŸ’¡ æœ€ä½³å®è·µ

### å¯¹äºç­–ç•¥å¼€å‘è€…ï¼š

1. **ç®€å•ç­–ç•¥**: ç›´æ¥ä½¿ç”¨æ¡†æ¶StateManager
2. **å¤æ‚ç­–ç•¥**: å‚è€ƒRecoveryåˆ›å»ºä¸“ç”¨StateManager
3. **çŠ¶æ€è®¾è®¡**: åŒºåˆ†åŸºç¡€çŠ¶æ€å’Œç­–ç•¥ç‰¹å®šçŠ¶æ€
4. **å‘½åè§„èŒƒ**: ä½¿ç”¨ç­–ç•¥åå‰ç¼€é¿å…å†²çª (å¦‚RecoveryStatePersister)

### å¯¹äºæ¡†æ¶ç»´æŠ¤è€…ï¼š

1. **ä¿æŒå…¼å®¹**: æ¡†æ¶StateManageræ¥å£ä¿æŒç¨³å®š
2. **æ–‡æ¡£æ›´æ–°**: æ˜ç¡®ä¸åŒStateManagerçš„ä½¿ç”¨åœºæ™¯
3. **ä»£ç å®¡æŸ¥**: ç¡®ä¿ç­–ç•¥StateManagerä¸ä¸æ¡†æ¶å†²çª

## ğŸ”§ æ¨èå‘½åè§„èŒƒ

- æ¡†æ¶çº§: `StateManager`
- ç­–ç•¥çº§: `{StrategyName}StateManager`
- ç¤ºä¾‹: `RecoveryStatePersister`, `MartingaleStatePersister`

è¿™æ ·çš„åˆ†å±‚è®¾è®¡ç¡®ä¿äº†æ¡†æ¶çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼ŒåŒæ—¶ä¸ºå¤æ‚ç­–ç•¥æä¾›äº†ä¸“ä¸šçš„çŠ¶æ€ç®¡ç†æ”¯æŒã€‚